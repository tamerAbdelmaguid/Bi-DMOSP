//---------------------------------------------------------------------------
#include <vcl.h>
#pragma hdrstop

#include "random.h"

/*----------------------------------------------------------------------------*/
/* random.c - contains random number generator and related utilities,         */
/* including advance_random, warmup_random, random, randomize, flip, and rnd  */
/*----------------------------------------------------------------------------*/

#include <math.h>

/* variables are declared static so that they cannot conflict with names of   */
/* other global variables in other files.  See K&R, p 80, for scope of static */
static double oldrand[55];                      /* Array of 55 random numbers */
static int jrand;                                    /* current random number */
static double rndx2;                       /* used with random normal deviate */
static int rndcalcflag;                    /* used with random normal deviate */

void advance_random()
/* Create next batch of 55 random numbers */
{
    int j1;
    double new_random;

    for(j1 = 0; j1 < 24; j1++)
    {
        new_random = oldrand[j1] - oldrand[j1+31];
        if(new_random < 0.0) new_random = new_random + 1.0;
        oldrand[j1] = new_random;
    }
    for(j1 = 24; j1 < 55; j1++)
    {
        new_random = oldrand [j1] - oldrand [j1-24];
        if(new_random < 0.0) new_random = new_random + 1.0;
        oldrand[j1] = new_random;
    }
}


bool flip(float prob)
/* Flip a biased coin - true if heads */
{
    return (frandom() <= prob);
}

void initrandomnormaldeviate()
/* initialization routine for randomnormaldeviate */
{
    rndcalcflag = 1;
}


double noise(double mu , double sigma)
/* normal noise with specified mean & std dev: mu & sigma */
{
    return((randomnormaldeviate()*sigma) + mu);
}



double randomnormaldeviate()
/* random normal deviate after ACM algorithm 267 / Box-Muller Method */
{
    double t, rndx1;

    if(rndcalcflag)
    {
        rndx1 = sqrt(- 2.0*log((double) frandom()));
        t = 6.2831853072 * (double) frandom();
        rndx2 = rndx1 * sin(t);
        rndcalcflag = 0;
        return(rndx1 * cos(t));
    }
    else
    {
        rndcalcflag = 1;
        return(rndx2);
    }
}


double frandom()
/* Fetch a single random number between 0.0 and 1.0 - Subtractive Method */
/* See Knuth, D. (1969), v. 2 for details */
/* name changed from random() to avoid library conflicts on some machines*/
{
    jrand++;
    if(jrand >= 55)
    {
        jrand = 1;
        advance_random();
    }
    return(oldrand[jrand]);
}


int rnd(int low, int high)
/* Pick a random integer between low and high */
{
    int i;

    if(low >= high)
        i = low;
    else
    {
        i = (frandom() * (high - low + 1)) + low;
        if(i > high) i = high;
    }
    return(i);
}


float rndreal(float lo , float hi)
/* real random number between specified limits */
{
    return((frandom() * (hi - lo)) + lo);
}


void warmup_random(float random_seed)
/* Get random off and running */
{
    int j1, ii;
    double new_random, prev_random;

    oldrand[54] = random_seed;
    new_random = 0.000000001;
    prev_random = random_seed;
    for(j1 = 1 ; j1 <= 54; j1++)
    {
        ii = (21*j1)%54;
        oldrand[ii] = new_random;
        new_random = prev_random-new_random;
        if(new_random<0.0) new_random = new_random + 1.0;
        prev_random = oldrand[ii];
    }

    advance_random();
    advance_random();
    advance_random();

    jrand = 0;
}

float NormalRandom(float mean, float stdev)
{
  int i = rnd(1, 999);
  return (mean + Znorm[i] * stdev);
}

float Znorm [999] =  {  // use a randome number between 1-999
-3.090244718	,       // as a reference to the probability 0.001-0.999
-2.878150553	,
-2.747765393	,
-2.65208655	,
-2.575834515	,
-2.512133506	,
-2.457272785	,
-2.408924047	,
-2.365613909	,
-2.326341928	,
-2.290362318	,
-2.257129381	,
-2.226206561	,
-2.19728463	,
-2.170090738	,
-2.144406608	,
-2.12006853	,
-2.096930984	,
-2.074848453	,
-2.053748176	,
-2.033521014	,
-2.014094207	,
-1.995394996	,
-1.977368811	,
-1.959961082	,
-1.94313543	,
-1.926837285	,
-1.911030267	,
-1.895696187	,
-1.880789569	,
-1.866292223	,
-1.852176865	,
-1.838425305	,
-1.825005711	,
-1.811913535	,
-1.799116944	,
-1.786611392	,
-1.774378688	,
-1.762409738	,
-1.750686351	,
-1.739199433	,
-1.727930794	,
-1.716884981	,
-1.706043804	,
-1.695398169	,
-1.684938979	,
-1.674661689	,
-1.664561751	,
-1.654625521	,
-1.644853	,
-1.635235094	,
-1.625762707	,
-1.616435839	,
-1.607249942	,
-1.598191375	,
-1.589269232	,
-1.580465323	,
-1.571788744	,
-1.563221304	,
-1.554772098	,
-1.546432031	,
-1.538201104	,
-1.530065674	,
-1.522034836	,
-1.514104042	,
-1.50625965	,
-1.498515303	,
-1.49085281	,
-1.483281267	,
-1.475791578	,
-1.468383743	,
-1.461057764	,
-1.453804543	,
-1.446633178	,
-1.439530024	,
-1.432504178	,
-1.425544269	,
-1.418652573	,
-1.411831363	,
-1.405073817	,
-1.398375389	,
-1.391745172	,
-1.385171799	,
-1.378657544	,
-1.372204679	,
-1.365806384	,
-1.359462658	,
-1.353173502	,
-1.346938916	,
-1.340754352	,
-1.334624358	,
-1.328539838	,
-1.322505341	,
-1.316520866	,
-1.310579592	,
-1.304686066	,
-1.298835741	,
-1.293033165	,
-1.287271516	,
-1.281550794	,
-1.275875547	,
-1.27023668	,
-1.264641014	,
-1.259084002	,
-1.253565642	,
-1.248085937	,
-1.242642611	,
-1.237235665	,
-1.231865099	,
-1.226528639	,
-1.221228558	,
-1.21596031	,
-1.210728442	,
-1.205526132	,
-1.200360202	,
-1.195221557	,
-1.190119292	,
-1.185044312	,
-1.180001163	,
-1.174987574	,
-1.170001269	,
-1.165046797	,
-1.160119609	,
-1.15522198	,
-1.150349362	,
-1.145504029	,
-1.140688255	,
-1.135895218	,
-1.131131739	,
-1.126390998	,
-1.121677542	,
-1.116986823	,
-1.112321115	,
-1.107680418	,
-1.103062459	,
-1.098469511	,
-1.093897026	,
-1.089349553	,
-1.084822543	,
-1.080320544	,
-1.075836735	,
-1.071377937	,
-1.06693733	,
-1.062519459	,
-1.058122052	,
-1.053745109	,
-1.049386356	,
-1.04505034	,
-1.040732514	,
-1.036432877	,
-1.032153705	,
-1.027892722	,
-1.023652203	,
-1.0194276	,
-1.015221187	,
-1.011035238	,
-1.006865205	,
-1.002711087	,
-0.99857516	,
-0.994457423	,
-0.990355602	,
-0.986271971	,
-0.982201982	,
-0.978150183	,
-0.9741143	,
-0.970094334	,
-0.96608801	,
-0.962099875	,
-0.958125383	,
-0.954164534	,
-0.950221875	,
-0.946290584	,
-0.942375209	,
-0.93847575	,
-0.934589934	,
-0.930717761	,
-0.926859229	,
-0.923014341	,
-0.919183094	,
-0.91536549	,
-0.911561528	,
-0.907768936	,
-0.903992259	,
-0.900226951	,
-0.896473011	,
-0.892732714	,
-0.88900606	,
-0.885290774	,
-0.881586857	,
-0.877896582	,
-0.874217676	,
-0.870550139	,
-0.86689397	,
-0.86324917	,
-0.859618012	,
-0.85599595	,
-0.852385256	,
-0.84878593	,
-0.845197974	,
-0.841621386	,
-0.838053893	,
-0.834497769	,
-0.830953013	,
-0.827417352	,
-0.82389306	,
-0.820379	,
-0.816874035	,
-0.813379302	,
-0.809895937	,
-0.806421667	,
-0.802956492	,
-0.799500413	,
-0.796055701	,
-0.792617811	,
-0.78919129	,
-0.785773864	,
-0.782365532	,
-0.778966296	,
-0.775573881	,
-0.772192834	,
-0.768820883	,
-0.765455752	,
-0.762099717	,
-0.758752776	,
-0.755414931	,
-0.752083906	,
-0.748761977	,
-0.745449142	,
-0.742143129	,
-0.738846211	,
-0.735557251	,
-0.732275112	,
-0.729003204	,
-0.725735845	,
-0.722478717	,
-0.71922841	,
-0.715986062	,
-0.712750534	,
-0.709521828	,
-0.706302217	,
-0.703089427	,
-0.699883458	,
-0.69668431	,
-0.693493121	,
-0.690308752	,
-0.687131205	,
-0.683960479	,
-0.680796575	,
-0.677639491	,
-0.674490366	,
-0.671345788	,
-0.668209168	,
-0.665079369	,
-0.661955255	,
-0.658837962	,
-0.655726353	,
-0.652621566	,
-0.649522462	,
-0.646431317	,
-0.64334472	,
-0.64026608	,
-0.637191988	,
-0.63412358	,
-0.631061994	,
-0.628006092	,
-0.624955874	,
-0.62191134	,
-0.618872491	,
-0.615839326	,
-0.612812983	,
-0.609791186	,
-0.606775075	,
-0.603764647	,
-0.600759904	,
-0.597760845	,
-0.594766334	,
-0.59177637	,
-0.588793228	,
-0.585814632	,
-0.582840585	,
-0.579873358	,
-0.576910679	,
-0.573952548	,
-0.570998964	,
-0.568052201	,
-0.565107712	,
-0.562170044	,
-0.559236923	,
-0.55630835	,
-0.553384325	,
-0.550464847	,
-0.547551053	,
-0.544641807	,
-0.541735972	,
-0.53883582	,
-0.535940217	,
-0.533048023	,
-0.530161515	,
-0.527279553	,
-0.524401003	,
-0.521526999	,
-0.518657544	,
-0.515791498	,
-0.512930001	,
-0.510074187	,
-0.507220648	,
-0.504371656	,
-0.501527211	,
-0.498687314	,
-0.49584969	,
-0.493017751	,
-0.490189223	,
-0.487364105	,
-0.484543534	,
-0.481727511	,
-0.478913762	,
-0.47610456	,
-0.473298769	,
-0.470497525	,
-0.467698555	,
-0.464904133	,
-0.462114258	,
-0.459326657	,
-0.456542466	,
-0.453762823	,
-0.450985453	,
-0.448212631	,
-0.44544322	,
-0.442676082	,
-0.439913492	,
-0.437153176	,
-0.434397407	,
-0.431643912	,
-0.428894964	,
-0.42614829	,
-0.423405027	,
-0.420664037	,
-0.417927595	,
-0.415193426	,
-0.412462668	,
-0.409735321	,
-0.407010248	,
-0.404289722	,
-0.401571469	,
-0.398855491	,
-0.396141786	,
-0.393432629	,
-0.390725745	,
-0.388022272	,
-0.385321073	,
-0.382622147	,
-0.379926632	,
-0.377233391	,
-0.374543561	,
-0.371856004	,
-0.369170721	,
-0.366489985	,
-0.363809249	,
-0.361133061	,
-0.358459147	,
-0.355787506	,
-0.353118139	,
-0.350451046	,
-0.347787363	,
-0.345125954	,
-0.342465682	,
-0.339809958	,
-0.33715537	,
-0.334503056	,
-0.331854153	,
-0.329206387	,
-0.326560894	,
-0.323918812	,
-0.321277867	,
-0.318639195	,
-0.316003934	,
-0.31336981	,
-0.31073796	,
-0.308108383	,
-0.30548108	,
-0.302854914	,
-0.300232159	,
-0.297611678	,
-0.294992333	,
-0.292375262	,
-0.289760465	,
-0.287146804	,
-0.284535417	,
-0.281926305	,
-0.279319465	,
-0.276713763	,
-0.274110334	,
-0.27150918	,
-0.268908025	,
-0.266311417	,
-0.26371481	,
-0.261120476	,
-0.25852728	,
-0.255936357	,
-0.25334657	,
-0.250759058	,
-0.248173819	,
-0.245589717	,
-0.243006752	,
-0.240426061	,
-0.237846507	,
-0.235269226	,
-0.232693083	,
-0.230118076	,
-0.227545343	,
-0.224973746	,
-0.222403287	,
-0.219833964	,
-0.217266916	,
-0.214702141	,
-0.212137365	,
-0.209574864	,
-0.207012363	,
-0.204452135	,
-0.201894181	,
-0.199336228	,
-0.196779411	,
-0.194224867	,
-0.191671461	,
-0.189118055	,
-0.186566922	,
-0.184016926	,
-0.181468067	,
-0.178920345	,
-0.17637376	,
-0.173829449	,
-0.171285137	,
-0.168740826	,
-0.166198788	,
-0.163659024	,
-0.16111926	,
-0.158579496	,
-0.156042006	,
-0.153504516	,
-0.150969299	,
-0.148434083	,
-0.145900003	,
-0.14336706	,
-0.140835255	,
-0.138304586	,
-0.135773917	,
-0.133244384	,
-0.130715989	,
-0.128188731	,
-0.125661472	,
-0.123135351	,
-0.120610366	,
-0.118085381	,
-0.115561534	,
-0.113038823	,
-0.110516112	,
-0.107994538	,
-0.105474101	,
-0.102952527	,
-0.100433226	,
-0.097913926	,
-0.095396899	,
-0.092878736	,
-0.090360572	,
-0.087844683	,
-0.085328793	,
-0.082812903	,
-0.08029815	,
-0.077783398	,
-0.075269782	,
-0.072756166	,
-0.07024255	,
-0.06773007	,
-0.065218728	,
-0.062706249	,
-0.060194907	,
-0.057684701	,
-0.055173359	,
-0.052663154	,
-0.050154085	,
-0.04764388	,
-0.045134811	,
-0.042625743	,
-0.040116674	,
-0.037607606	,
-0.035099674	,
-0.032591743	,
-0.030083811	,
-0.027575879	,
-0.025069085	,
-0.022561153	,
-0.020054358	,
-0.017547563	,
-0.015040769	,
-0.012532837	,
-0.010027179	,
-0.007519247	,
-0.00501359	,
-0.002506795	,
0	,
0.002506795	,
0.00501359	,
0.007519247	,
0.010027179	,
0.012532837	,
0.015040769	,
0.017547563	,
0.020054358	,
0.022561153	,
0.025069085	,
0.027575879	,
0.030083811	,
0.032591743	,
0.035099674	,
0.037607606	,
0.040116674	,
0.042625743	,
0.045134811	,
0.04764388	,
0.050154085	,
0.052663154	,
0.055173359	,
0.057684701	,
0.060194907	,
0.062706249	,
0.065218728	,
0.06773007	,
0.07024255	,
0.072756166	,
0.075269782	,
0.077783398	,
0.08029815	,
0.082812903	,
0.085328793	,
0.087844683	,
0.090360572	,
0.092878736	,
0.095396899	,
0.097913926	,
0.100433226	,
0.102952527	,
0.105474101	,
0.107994538	,
0.110516112	,
0.113038823	,
0.115561534	,
0.118085381	,
0.120610366	,
0.123135351	,
0.125661472	,
0.128188731	,
0.130715989	,
0.133244384	,
0.135773917	,
0.138304586	,
0.140835255	,
0.14336706	,
0.145900003	,
0.148434083	,
0.150969299	,
0.153504516	,
0.156042006	,
0.158579496	,
0.16111926	,
0.163659024	,
0.166198788	,
0.168740826	,
0.171285137	,
0.173829449	,
0.17637376	,
0.178920345	,
0.181468067	,
0.184016926	,
0.186566922	,
0.189118055	,
0.191671461	,
0.194224867	,
0.196779411	,
0.199336228	,
0.201894181	,
0.204452135	,
0.207012363	,
0.209574864	,
0.212137365	,
0.214702141	,
0.217266916	,
0.219833964	,
0.222403287	,
0.224973746	,
0.227545343	,
0.230118076	,
0.232693083	,
0.235269226	,
0.237846507	,
0.240426061	,
0.243006752	,
0.245589717	,
0.248173819	,
0.250759058	,
0.25334657	,
0.255936357	,
0.25852728	,
0.261120476	,
0.26371481	,
0.266311417	,
0.268908025	,
0.27150918	,
0.274110334	,
0.276713763	,
0.279319465	,
0.281926305	,
0.284535417	,
0.287146804	,
0.289760465	,
0.292375262	,
0.294992333	,
0.297611678	,
0.300232159	,
0.302854914	,
0.30548108	,
0.308108383	,
0.31073796	,
0.31336981	,
0.316003934	,
0.318639195	,
0.321277867	,
0.323918812	,
0.326560894	,
0.329206387	,
0.331854153	,
0.334503056	,
0.33715537	,
0.339809958	,
0.342465682	,
0.345125954	,
0.347787363	,
0.350451046	,
0.353118139	,
0.355787506	,
0.358459147	,
0.361133061	,
0.363809249	,
0.366489985	,
0.369170721	,
0.371856004	,
0.374543561	,
0.377233391	,
0.379926632	,
0.382622147	,
0.385321073	,
0.388022272	,
0.390725745	,
0.393432629	,
0.396141786	,
0.398855491	,
0.401571469	,
0.404289722	,
0.407010248	,
0.409735321	,
0.412462668	,
0.415193426	,
0.417927595	,
0.420664037	,
0.423405027	,
0.42614829	,
0.428894964	,
0.431643912	,
0.434397407	,
0.437153176	,
0.439913492	,
0.442676082	,
0.44544322	,
0.448212631	,
0.450985453	,
0.453762823	,
0.456542466	,
0.459326657	,
0.462114258	,
0.464904133	,
0.467698555	,
0.470497525	,
0.473298769	,
0.47610456	,
0.478913762	,
0.481727511	,
0.484543534	,
0.487364105	,
0.490189223	,
0.493017751	,
0.49584969	,
0.498687314	,
0.501527211	,
0.504371656	,
0.507220648	,
0.510074187	,
0.512930001	,
0.515791498	,
0.518657544	,
0.521526999	,
0.524401003	,
0.527279553	,
0.530161515	,
0.533048023	,
0.535940217	,
0.53883582	,
0.541735972	,
0.544641807	,
0.547551053	,
0.550464847	,
0.553384325	,
0.55630835	,
0.559236923	,
0.562170044	,
0.565107712	,
0.568052201	,
0.570998964	,
0.573952548	,
0.576910679	,
0.579873358	,
0.582840585	,
0.585814632	,
0.588793228	,
0.59177637	,
0.594766334	,
0.597760845	,
0.600759904	,
0.603764647	,
0.606775075	,
0.609791186	,
0.612812983	,
0.615839326	,
0.618872491	,
0.62191134	,
0.624955874	,
0.628006092	,
0.631061994	,
0.63412358	,
0.637191988	,
0.64026608	,
0.64334472	,
0.646431317	,
0.649522462	,
0.652621566	,
0.655726353	,
0.658837962	,
0.661955255	,
0.665079369	,
0.668209168	,
0.671345788	,
0.674490366	,
0.677639491	,
0.680796575	,
0.683960479	,
0.687131205	,
0.690308752	,
0.693493121	,
0.69668431	,
0.699883458	,
0.703089427	,
0.706302217	,
0.709521828	,
0.712750534	,
0.715986062	,
0.71922841	,
0.722478717	,
0.725735845	,
0.729003204	,
0.732275112	,
0.735557251	,
0.738846211	,
0.742143129	,
0.745449142	,
0.748761977	,
0.752083906	,
0.755414931	,
0.758752776	,
0.762099717	,
0.765455752	,
0.768820883	,
0.772192834	,
0.775573881	,
0.778966296	,
0.782365532	,
0.785773864	,
0.78919129	,
0.792617811	,
0.796055701	,
0.799500413	,
0.802956492	,
0.806421667	,
0.809895937	,
0.813379302	,
0.816874035	,
0.820379	,
0.82389306	,
0.827417352	,
0.830953013	,
0.834497769	,
0.838053893	,
0.841621386	,
0.845197974	,
0.84878593	,
0.852385256	,
0.85599595	,
0.859618012	,
0.86324917	,
0.86689397	,
0.870550139	,
0.874217676	,
0.877896582	,
0.881586857	,
0.885290774	,
0.88900606	,
0.892732714	,
0.896473011	,
0.900226951	,
0.903992259	,
0.907768936	,
0.911561528	,
0.91536549	,
0.919183094	,
0.923014341	,
0.926859229	,
0.930717761	,
0.934589934	,
0.93847575	,
0.942375209	,
0.946290584	,
0.950221875	,
0.954164534	,
0.958125383	,
0.962099875	,
0.96608801	,
0.970094334	,
0.9741143	,
0.978150183	,
0.982201982	,
0.986271971	,
0.990355602	,
0.994457423	,
0.99857516	,
1.002711087	,
1.006865205	,
1.011035238	,
1.015221187	,
1.0194276	,
1.023652203	,
1.027892722	,
1.032153705	,
1.036432877	,
1.040732514	,
1.04505034	,
1.049386356	,
1.053745109	,
1.058122052	,
1.062519459	,
1.06693733	,
1.071377937	,
1.075836735	,
1.080320544	,
1.084822543	,
1.089349553	,
1.093897026	,
1.098469511	,
1.103062459	,
1.107680418	,
1.112321115	,
1.116986823	,
1.121677542	,
1.126390998	,
1.131131739	,
1.135895218	,
1.140688255	,
1.145504029	,
1.150349362	,
1.15522198	,
1.160119609	,
1.165046797	,
1.170001269	,
1.174987574	,
1.180001163	,
1.185044312	,
1.190119292	,
1.195221557	,
1.200360202	,
1.205526132	,
1.210728442	,
1.21596031	,
1.221228558	,
1.226528639	,
1.231865099	,
1.237235665	,
1.242642611	,
1.248085937	,
1.253565642	,
1.259084002	,
1.264641014	,
1.27023668	,
1.275875547	,
1.281550794	,
1.287271516	,
1.293033165	,
1.298835741	,
1.304686066	,
1.310579592	,
1.316520866	,
1.322505341	,
1.328539838	,
1.334624358	,
1.340754352	,
1.346938916	,
1.353173502	,
1.359462658	,
1.365806384	,
1.372204679	,
1.378657544	,
1.385171799	,
1.391745172	,
1.398375389	,
1.405073817	,
1.411831363	,
1.418652573	,
1.425544269	,
1.432504178	,
1.439530024	,
1.446633178	,
1.453804543	,
1.461057764	,
1.468383743	,
1.475791578	,
1.483281267	,
1.49085281	,
1.498515303	,
1.50625965	,
1.514104042	,
1.522034836	,
1.530065674	,
1.538201104	,
1.546432031	,
1.554772098	,
1.563221304	,
1.571788744	,
1.580465323	,
1.589269232	,
1.598191375	,
1.607249942	,
1.616435839	,
1.625762707	,
1.635235094	,
1.644853	,
1.654625521	,
1.664561751	,
1.674661689	,
1.684938979	,
1.695398169	,
1.706043804	,
1.716884981	,
1.727930794	,
1.739199433	,
1.750686351	,
1.762409738	,
1.774378688	,
1.786611392	,
1.799116944	,
1.811913535	,
1.825005711	,
1.838425305	,
1.852176865	,
1.866292223	,
1.880789569	,
1.895696187	,
1.911030267	,
1.926837285	,
1.94313543	,
1.959961082	,
1.977368811	,
1.995394996	,
2.014094207	,
2.033521014	,
2.053748176	,
2.074848453	,
2.096930984	,
2.12006853	,
2.144406608	,
2.170090738	,
2.19728463	,
2.226206561	,
2.257129381	,
2.290362318	,
2.326341928	,
2.365613909	,
2.408924047	,
2.457272785	,
2.512133506	,
2.575834515	,
2.65208655	,
2.747765393	,
2.878150553	,
3.090244718	,
};
//---------------------------------------------------------------------------
#pragma package(smart_init)
